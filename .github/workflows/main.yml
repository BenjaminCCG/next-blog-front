# ci.yml
name: next-blog-front

on:
    push:
        branches: 
          - master
jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout code
              uses: actions/checkout@v3
                
            - name: Deploy
              uses: matheusvanzan/sshpass-action@v2
              with:
                  host: ${{ secrets.REMOTE_HOST }}
                  user: 'root'
                  port: 22
                  pass: ${{ secrets.REMOTE_PASSWORD }}
                  run: | 
                    sudo ln -s "$NVM_DIR/versions/node/$(nvm version)/bin/npm" "/usr/local/bin/npm" 
                    sudo ln -s "$NVM_DIR/versions/node/$(nvm version)/bin/pm2" "/usr/local/bin/pm2"
                    cd /root/next/next-blog-front
                    pm2 kill
                    git pull origin
                    npm run install
                    npm run build
                    npm run pm2-start
                    pwd
                    exit
