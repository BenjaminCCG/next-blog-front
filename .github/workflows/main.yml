# ci.yml
name: next-blog-front

on:
    push:
        branches: 
          - master
jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout code
              uses: actions/checkout@v2

            - name: Install dependencies
              run: |
                sudo apt-get update
                sudo apt-get install -y npm
                sudo npm install -g pm2
                
            - name: Deploy
              uses: matheusvanzan/sshpass-action@v2
              with:
                  host: ${{ secrets.REMOTE_HOST }}
                  user: 'root'
                  port: 22
                  pass: ${{ secrets.REMOTE_PASSWORD }}
                  run: | 
                    cd /root/next/next-blog-front
                    pm2 kill
                    git pull origin
                    npm run build
                    npm run pm2-start
                    pwd
                    exit
